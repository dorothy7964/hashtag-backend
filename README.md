# 해시태그

[front Github 바로가기](hhttps://github.com/dorothy7964/hashtag-frontend "frontend Github 바로가기") <br/>

# Install

## nodemon

<!-- Install Code -->

``` js
$ yarn add nodemon -D
```

nodemon 은 파일을 저장할 때마다 실행을 새로 해주는 도구 입니다. <br/>
서버를 껐다가 켤 필요가 없습니다. <br/>

<br/><br/>

## @babel-cli

<!-- Install Code -->

``` js
$ yarn add @babel-cli
```

babel은 es6코드를 es5로 바꿔주는 도구 입니다. <br/>
아직 지원되지 않는 곳들이 있어서 못생긴 코드로 바꿔줘야 합니다.  <br/>

<br/><br/>

## @babel/node

<!-- Install Code -->

``` js
$ yarn add @babel/node
```

babel-node는 Node.js CLI와 정확히 동일하게 작동하는 CLI로, 실행하기 전에 Babel 사전 설정 및 플러그인으로 컴파일할 수 있는 부가적인 이점이 있습니다.


<br/><br/>

## @babel/preset-env

<!-- Install Code -->

``` js
$ yarn add @babel/preset-env
```

ECMAScript5+ 버전 호환성을 위하여 정의된 플러그인의 집합 입니다.

<br/><br/>

## @babel/core

<!-- Install Code -->

``` js
$ yarn add @babel/core
```

Babel을 사용하기 위한 플러그인 (babel.config.js) 입니다.

<br/><br/>

## morgan

<!-- Install Code -->

``` js
$ yarn add morgan
```

morgan 이라는 미들웨어를 추가하고 logger(로깅 전문 모듈) 입니다.

<br/><br/>

## dotenv

<!-- Install Code -->

``` js
$ yarn add dotenv
```

prisma 를 시작하지 전 dotenv 설치 합니다. <br/>
서버를 먼저 세우고, 그 다음에 prisma 를 서버 코드에 추가 합니다.

<br/><br/>

## graphql-yoga

<!-- Install Code -->

``` js
$ yarn add graphql-yoga
```

의존성 모듈(dependency)들을 설치 합니다. <br/>
graphql-yoga를 사용하기 때문에 express는 필요 없습니다.

<br/><br/>

## graphql-tools

<!-- Install Code -->

``` js
$ yarn add graphql-tools
```

graphql 파일 분리 하려면 필요 합니다.

<br/><br/>

## merge-graphql-schemas

<!-- Install Code -->

``` js
$ yarn add merge-graphql-schemas
```

graphql 파일 분리 하려면 필요 합니다.

<br/><br/>
<!--ㅇㅇㅇㅇㅇㅇㅇㅇ -->

## 만약  babel/cli -D  로 설치 했을 경우 제거해주기

<!-- Install Code -->

``` js
$ yarn remove babel-cli
$ yarn global remove babel-cli
```

[오류발생] babel/cli -D 로 설치 했을 경우 최신 버전 @babel/clli 를 설치해야 합니다.

<br/><br/>

# 파일 생성

### nodemon.json 파일 생성

<!-- Example Code -->

``` js
{
    "ext": "js graphql"
}
```
이 파일에 ext 라는 걸 추가 합니다. <br/>
nodemon이 감시해야 할 파일의 확장자들을 지정할 수 있습니다.

<br/><br/>

### .gitignore 파일 생성

<!-- Example Code -->

``` js
{
// ~/wam-prj/prismagram/.gitignore

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (https://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# TypeScript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# next.js build output
.next
generated
build
}
```

업로드 제외할 것들 넣어습니다.

<br/><br/>

### .env 파일 생성

<!-- Example Code -->

``` js
PORT=4000
```

### .babelrc 파일 생성

<!-- Example Code -->

``` js
{
    "presets": ["@babel/preset-env"]
}
```

babelrc 파일에 presets 작성하기 <br/>
가장 최신의 프리셋인 @babel/preset-env 를 사용 합니다. 

<br/><br/>

### env.js 파일 생성

<!-- Example Code -->

``` js
import dotenv from 'dotenv';
dotenv.config();
```

<br/><br/>

### schema 파일 생성

<!-- Example Code -->

``` js
import path from "path";  

import { makeExecutableSchema } from "graphql-tools";  
import { fileLoader, mergeResolvers, mergeTypes } from "merge-graphql-schemas";

const allTypes = fileLoader(path.join(__dirname, "/api/**/*.graphql"));
const allResolvers = fileLoader(path.join(__dirname, "/api/**/*.js"));

const schema = makeExecutableSchema({
    typeDefs: mergeTypes(allTypes),
    resolvers: mergeResolvers(allResolvers)
});

export default schema;
```

<br/>

**schema 설명**

- **fileLoader** : 인자로 path를 받아 파일을 load해줍니다.
- **path.join** : 해당 경로의 파일들을 가져옵니다.
- **makeExecutabelSchema** : type, resolver를 schema 형태로 만들어 줍니다.

<!-- Example Code -->

``` js
// ~/wam-prj/prismagram/src/schema.js

import path from "path";  // 설명[3-1]

// 설명[1]
import { makeExecutableSchema } from "graphql-tools";  
import { fileLoader, mergeResolvers, mergeTypes } from "merge-graphql-schemas";

// 설명[3]
const allTypes = fileLoader(path.join(__dirname, "/api/**/*.graphql"));
const allResolvers = fileLoader(path.join(__dirname, "/api/**/*.js"));

// 설명[2]
const schema = makeExecutableSchema({
    typeDefs: mergeTypes(allTypes),
    resolvers: mergeResolvers(allResolvers)
});

// 설명[4]
export default schema;
```

**설명[1]**

<!-- Example Code -->

``` js
import { makeExecutableSchema } from "graphql-tools";  
import { fileLoader, mergeResolvers, mergeTypes } from "merge-graphql-schemas";
```

graphql-tools, merge-graphql-schemas 설치해 준 것들을 불러와 줍니다.

<br/>

**설명[2]**

<!-- Example Code -->

``` js
const schema = makeExecutableSchema({
    typeDefs: mergeTypes(allTypes),
    resolvers: mergeResolvers(allResolvers)
});
```

schema 파일에 우선 모든 type 들을 추가 합니다. <br/>
makeExecutableSchemas 함수의 인자로 typeDefs 와 resolvers 를 입력해주면 됩니다. <br/>
allTypes 라는 변수를 만들고 이 변수는 fileLoader 함수의 결과물 입니다.

 <br/>


**설명[3]**

[참고] api 폴더 밑에는 resolver 가 아닌 js 파일을 두면 안됩니다! <br/>
api 폴더 밑에는 resolver 나 graphql 아닌 파일을 두지 않기!  <br/>

<!-- Example Code -->

``` js
const allTypes = fileLoader(path.join(__dirname, "/api/**/*.graphql"));
const allResolvers = fileLoader(path.join(__dirname, "/api/**/*.js"));
```
fileLoader 함수의 인자로 path.join(__dirname, "/api/**/*.graphql") 을 입력
** 는 모든 폴더고, *.graphql 은 모든 .graphql 파일 입니다.  <br/>

다시말해 api 폴더 밑의 모든 폴더에 속해있고 .graphql 로 끝나는 모든 파일들을 가져오는 것 입니다.  <br/>

같은 방식으로 allResolvers 를 만들기  <br/>
이렇게 하면 아주 긴 파일경로를 입력하게 되는 것 입니다.  <br/>
api 폴더 밑에 모든 폴더의 파일들 중 .js 로 끝나는 파일들을 입력하기

<br/>

``` js
import path from "path";  // 설명[3-1]
```

fileLoader 함수의 인자로 파일의 경로를 입력 해야 합니다. <br/>
path 모듈을 import 하기

<br/>

**설명[4]**

<!-- Example Code -->

``` js
export default schema;
```

마지막으로 내보내주면 됩니다.

<br/><br/>

### package.json 

<!-- Example Code -->

``` js
// ~/wam-prj/prismagram/package.json

{
  "name": "prismagram",
  "version": "1.0.0",
  "description": "Instragram clone with Express + Prisma + React and React Native",
  //"main": "index.js", 이부분은 필요없으므로 이 줄 삭제하기
  "license": "MIT",
  "dependencies": {
    "graphql-yoga": "^1.18.2"
  }
}
```

**scripts 추가하기**

<!-- Example Code -->

``` js
// ~/wam-prj/prismagram/package.json
    
"scripts": {
	  "dev": "nodemon --exec babel-node src/server.js",
	  "deploy": "prisma deploy",
	  "generate": "prisma generate",
	  "prisma": "yarn run deploy && yarn run generate",
	  "prebuild": "yarn run generate",
	  "build": "babel src -d build",
	  "postbuild": "npx copy src/api/**/**.graphql ./build/api/",
	  "start": "node build/server.js"
}
```

**실행**

<!-- Example Code -->

``` js
$ yarn dev
```

<br/><br/>
